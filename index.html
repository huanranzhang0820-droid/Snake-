<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Love Snake ❤️</title>
  <style>
    :root { font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    body { margin:0; background:#0b0f14; color:#e7eef8; display:flex; min-height:100vh; align-items:center; justify-content:center; }
    .wrap { width:min(520px, 94vw); }
    .topbar { display:flex; gap:10px; align-items:center; justify-content:space-between; margin-bottom:10px; }
    .stats { display:flex; gap:14px; align-items:center; font-weight:700; }
    button{
      background:#1b2430; color:#e7eef8; border:1px solid #2b3a4d;
      border-radius:12px; padding:8px 12px; cursor:pointer; font-weight:700;
    }
    .card { background:#111824; border:1px solid #223044; border-radius:14px; padding:12px; }
    canvas { width:100%; height:auto; background:#0e1520; border-radius:12px; display:block; touch-action:none; }

    .controls { margin-top:12px; display:flex; gap:12px; align-items:center; justify-content:space-between; }
    .dpad { width:180px; height:180px; display:grid; grid-template-columns:repeat(3, 1fr); grid-template-rows:repeat(3,1fr); gap:8px; }
    .dpad button { padding:0; height:100%; font-size:18px; }
    .dpad .blank { opacity:0; pointer-events:none; }
    .rightcol { display:flex; flex-direction:column; gap:10px; align-items:stretch; flex:1; }
    .rightcol button { width:100%; }
    .hint { margin-top:10px; opacity:.85; font-size:14px; line-height:1.5; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="stats">
        <div>Score: <span id="score">0</span></div>
        <div>Best: <span id="best">0</span></div>
      </div>
      <div class="btns">
        <button id="btnPause">Pause</button>
        <button id="btnRestart">Restart</button>
      </div>
    </div>

    <div class="card">
      <canvas id="game" width="400" height="400"></canvas>

      <div class="controls">
        <div class="dpad">
          <button class="blank"></button>
          <button data-dir="U">↑</button>
          <button class="blank"></button>

          <button data-dir="L">←</button>
          <button id="btnAction">Start</button>
          <button data-dir="R">→</button>

          <button class="blank"></button>
          <button data-dir="D">↓</button>
          <button class="blank"></button>
        </div>

        <div class="rightcol">
          <button id="btnSpeed">Speed: Normal</button>
          <button id="btnGrid">Grid: 20×20</button>
        </div>
      </div>

      <div class="hint">
        Swipe on the board or tap arrows to move.<br/>
        Eat ❤️ hearts to score points. Don’t hit walls or yourself.
      </div>
    </div>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const scoreEl = document.getElementById('score');
  const bestEl  = document.getElementById('best');
  const btnPause = document.getElementById('btnPause');
  const btnRestart = document.getElementById('btnRestart');
  const btnAction = document.getElementById('btnAction');
  const btnSpeed = document.getElementById('btnSpeed');
  const btnGrid = document.getElementById('btnGrid');

  let gridSize = 20;
  let cell = canvas.width / gridSize;

  const speeds = [
    {name:'Slow', ms:140},
    {name:'Normal', ms:95},
    {name:'Fast', ms:70},
    {name:'Insane', ms:50},
  ];
  let speedIndex = 1;

  let snake, dir, nextDir, food, score, best, running, paused, timer;

  best = Number(localStorage.getItem('snake_best') || 0);
  bestEl.textContent = best;

  function randCell() {
    return { x: Math.floor(Math.random() * gridSize), y: Math.floor(Math.random() * gridSize) };
  }

  function placeFood() {
    while (true) {
      const p = randCell();
      if (!snake.some(s => s.x === p.x && s.y === p.y)) return p;
    }
  }

  function reset() {
    snake = [{x: Math.floor(gridSize/2), y: Math.floor(gridSize/2)}];
    dir = {x:1, y:0};
    nextDir = dir;
    food = placeFood();
    score = 0;
    running = false;
    paused = false;
    clearInterval(timer);
    scoreEl.textContent = score;
    btnAction.textContent = 'Start';
    btnPause.textContent = 'Pause';
    draw();
  }

  function start() {
    if (running) return;
    running = true;
    paused = false;
    btnAction.textContent = 'Playing';
    loop();
  }

  function loop() {
    clearInterval(timer);
    timer = setInterval(() => {
      if (!running || paused) return;
      step();
      draw();
    }, speeds[speedIndex].ms);
  }

  function gameOver() {
    running = false;
    clearInterval(timer);
    alert('Game Over! Score: ' + score);
    if (score > best) {
      best = score;
      localStorage.setItem('snake_best', best);
      bestEl.textContent = best;
    }
  }

  function step() {
    dir = nextDir;
    const head = snake[0];
    const nx = head.x + dir.x;
    const ny = head.y + dir.y;

    if (nx < 0 || ny < 0 || nx >= gridSize || ny >= gridSize) return gameOver();
    if (snake.some((s,i)=>i && s.x===nx && s.y===ny)) return gameOver();

    snake.unshift({x:nx, y:ny});

    if (nx === food.x && ny === food.y) {
      score += 10;
      scoreEl.textContent = score;
      food = placeFood();
    } else {
      snake.pop();
    }
  }

  function drawHeart(x,y){
    ctx.font = `${Math.floor(cell*0.8)}px Apple Color Emoji`;
    ctx.textAlign='center';
    ctx.textBaseline='middle';
    ctx.fillText('❤️', x*cell+cell/2, y*cell+cell/2+1);
  }

  function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawHeart(food.x, food.y);
    snake.forEach((s,i)=>{
      ctx.fillStyle = i ? '#42c7ff' : '#7cf2c4';
      ctx.fillRect(s.x*cell+2, s.y*cell+2, cell-4, cell-4);
    });
  }

  function setDir(x,y){
    if (x === -dir.x && y === -dir.y) return;
    nextDir={x,y};
    if (!running) start();
  }

  document.querySelectorAll('[data-dir]').forEach(b=>{
    b.onclick=()=>({U:[0,-1],D:[0,1],L:[-1,0],R:[1,0]}[b.dataset.dir]&&setDir(...({U:[0,-1],D:[0,1],L:[-1,0],R:[1,0]}[b.dataset.dir])));
  });

  let startTouch=null;
  canvas.ontouchstart=e=>startTouch={x:e.touches[0].clientX,y:e.touches[0].clientY};
  canvas.ontouchend=e=>{
    if(!startTouch)return;
    let dx=e.changedTouches[0].clientX-startTouch.x;
    let dy=e.changedTouches[0].clientY-startTouch.y;
    if(Math.abs(dx)>Math.abs(dy)) setDir(dx>0?1:-1,0);
    else setDir(0,dy>0?1:-1);
    startTouch=null;
  };

  btnPause.onclick=()=>{paused=!paused; btnPause.textContent=paused?'Resume':'Pause';};
  btnRestart.onclick=reset;
  btnSpeed.onclick=()=>{speedIndex=(speedIndex+1)%speeds.length; btnSpeed.textContent='Speed: '+speeds[speedIndex].name; if(running)loop();};
  btnGrid.onclick=()=>{gridSize=gridSize===20?25:gridSize===25?16:20; btnGrid.textContent='Grid: '+gridSize+'×'+gridSize; cell=canvas.width/gridSize; reset();};

  reset();
})();
</script>
</body>
</html>
